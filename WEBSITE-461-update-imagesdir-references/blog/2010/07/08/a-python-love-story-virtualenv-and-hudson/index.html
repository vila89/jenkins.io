<!DOCTYPE html>
<html>
<head>
<title>
A Python Love Story: Virtualenv and Hudson
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins is an open source automation server" name="description">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/sites/default/files/jenkins_favicon.ico" rel="shortcut icon" type="image/x-icon">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/img/favicon.ico" rel="icon" sizes="32x32" type="img/png">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/img/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/img/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/img/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/img/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/img/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
<meta content="A Python Love Story: Virtualenv and Hudson" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="A Python Love Story: Virtualenv and Hudson" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<!-- Open Graph data -->
<meta content="A Python Love Story: Virtualenv and Hudson" property="og:title">
<meta content="article" property="og:type">
<meta content="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/blog/2010/07/08/a-python-love-story-virtualenv-and-hudson/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="og:description">
<meta content="A Python Love Story: Virtualenv and Hudson" property="og:site_name">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/css/font-icons.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/css/jenkins.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/css/footer.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/css/font-awesome.min.css" media="screen" rel="stylesheet">
</head>
<body>
<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/assets/bower/jquery/jquery.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<nav class="navbar navbar-toggleable-md navbar-inverse top bg-inverse fixed-top" id="ji-toolbar">
<div class="container">
<button class="navbar-toggler navbar-toggler-rght hidden-lg-up float-right" data-target="#CollapsingNavbar" data-toggle="collapse" type="button">
<i class="ion-navicon"></i>
</button>
<a class="navbar-brand" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references">
Jenkins
</a>
<div class="collapse navbar-collapse" id="CollapsingNavbar">
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/node">
Blog
</a>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
Documentation
</div>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/doc">
Use Jenkins
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/doc/developer">
Extend Jenkins
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
Use-cases
</div>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/android">
Android
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/c">
C/C++
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/docker">
Docker
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/embedded">
Embedded
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/github">
GitHub
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/java">
Java
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/php">
PHP
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/pipeline">
Continuous Delivery
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/python">
Python
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/ruby">
Ruby
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/participate">
Participate
</a>
</li>
<li class="dropdown nav-item">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">Sub-projects</div>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/projects/">
Overview
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/projects/blueocean/">
Blue Ocean
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/projects/gsoc/">
Google Summer of Code
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/projects/infrastructure/">
Infrastructure
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/projects/jam/">
Jenkins Area Meetups
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/projects/remoting/">
Jenkins Remoting
</a>
</div>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
Resources
</div>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://accounts.jenkins.io/" title="Create/manage your account for accessing wiki, issue tracker, etc">
Account Management
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/chat" title="Chat with the rest of the Jenkins community on IRC">
Chat
</a>
<a class="dropdown-item feature" href="https://issues.jenkins-ci.org/">
Issue Tracker
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/mailing-lists" title="Browse Jenkins mailing list archives and/or subscribe to lists">
Mailing Lists
</a>
<a class="dropdown-item feature" href="https://wiki.jenkins-ci.org/">
Wiki
</a>
</div>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
About
</div>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/security">
Security
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/press">
Press
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/project/conduct">
Conduct
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/artwork">
Artwork
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link btn btn-outline-secondary" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/download">
Download
</a>
</li>
</ul>
</div>
</div>
</nav>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('#content h' + i);
    }
  })
</script>
<div class="container blog-post">
<div class="row body">
<div class="col-md-11 col-md-offset-1 main-content" id="content">
<div id="content-top">
<h1>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/blog/2010/07/08/a-python-love-story-virtualenv-and-hudson/" title="A Python Love Story: Virtualenv and Hudson">
A Python Love Story: Virtualenv and Hudson
</a>
</h1>
<div style="float: right; clear: all;">
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/share">
Tweet
</a>
</div>
<div class="post-attrs">
<span class="submitted">
Published on
2010-07-08
by
<a href="#about-the-author">R. Tyler Croy</a>
</span>
<ul class="list-inline tags">
<li>
<a class="tag-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/node/tags/general">
general
</a>
</li>
<li>
<a class="tag-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/node/tags/guest post">
guest post
</a>
</li>
<li>
<a class="tag-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/node/tags/tutorial">
tutorial
</a>
</li>
</ul>
</div>
</div>
Over the past year Hudson has grown tremendously, both within the Java community and outside of it. Partially thanks to [Titus Brown](http://twitter.com/ctitusbrown)'s PyCon 2010 Atlanta coverage of continuous integration for Python (which we've [covered before](http://www.hudson-labs.org/content/hudson-pycon)), Hudson has made great strides within the Python community as well.

In my experience, the majority of Python developers are not using Hudson to **build** anything, unless they have C extensions, but rather to *test* their packages, which presents its own set of specific requirements for jobs. Jobs for testing Python code need to be able to reliaby reproduce an environment with the same set of dependencies from one run to the next in order to provide consistent testing. Unlike their Java counterparts, Python developers cannot rely on a powerful system like <a id="aptureLink_5i6m9B8BGf" href="http://maven.apache.org/">Maven2</a> for enumerating build/test targets or defining their project's dependencies in their jobs; fortunately, w
e can have something close: [virtualenv](http://pypi.python.org/pypi/virtualenv) and [pip](http://pypi.python.org/pypi/pip).

Virtualenv does exactly what you might expect it to, it creates a "virtual environment" with custom `site-packages` directory, and modified `python` executable. Using virtualenv you can create a staged environment to use for running unit and integration tests. Adding pip alongside that and you have a **fantastic** Python package manager/installer to use with the virtual environment.

Below, I've outlined the steps required to use virtualenv and pip to *automatically* manage a custom environment for your Python jobs.
<!--break-->
### The Recipe

For this recipe to work, you should make sure that your slave machines all have `virtualenv` and `pip` installed and accessible from your slave agent's `$PATH`. For Mac OS X users, `sudo easy_install virtualenv` should do the trick, Linux users should be able to run `sudo [aptitude/yum/zypper] install python-virtualenv` with your respective package manager.

You will also need the [SetEnv Plugin](http://wiki.hudson-ci.org/display/HUDSON/Setenv+Plugin) installed in Hudson.

#### Step 1

Inside of the job's configuration page ([http;//hudson/job/configure](http://hudson/job/configure)), we need to define an environment variable for the job. Using the SetEnv plugin, define a new `$PATH`:

<code type="bash">
    PATH=.env/bin:$PATH</code>

What this will do is modify the `$PATH` environment variable for all of the "Execute shell" build steps in your job. As you might have guessed, we're going to install the virtualenv in `.env` in the workspace root directory.

#### Step 2

To set up the virtualenv, you want to add a build step of type "Execute shell" and paste the following commands into the text area:

<code type="bash">
    if [ -d ".env" ]; then
        echo "**> virtualenv exists"
    else
        echo "**> creating virtualenv"
        virtualenv .env
    fi
</code>

This will create a virtualenv the first time the job runs on a particular slave, a virtualenv that will persist until the workspace is cleared. Since we're going to install dependencies in the virtualenv, we want to keep it around between jobs to reduce the amount of network hits to download packages.

#### Step 3

With our virtualenv and our `$PATH` properly set up, the job can now properly install dependencies into its virtualenv, this is where `pip` shines. A little known feature of `pip` allows you to define a "requirements file" which enumerates the packages to install. In my example project, I defined the following requirements in a file called `pip-requires.txt`

<code type="bash">
    eventlet>=0.9.9
    nose>=0.11.3
    MySQL-python>=1.2.3c1
</code>

In my hypothetical example, I'll need `nose` to run my tests, while `eventlet` and `MySQL-python` are required for my project to properly run. With the `pip-requires.txt` file in the root of my source repository, I can add an additional "Execute shell" build step that does the following:

<code type="bash">
    pip install -r pip-requires.txt
</code>

Assuming the `$PATH` environment variable was properly defined, this will use the virtualenv's version of `pip` and it will install the packages defined in `pip-requires.txt` **into** the virtualenv!

With the dependencies all properly installed in the virtualenv, I can now configure the remainder of my job to build my project and execute the tests. Pretty snazzy if you ask me!

<!-- starting partial author.html.haml -->
<div id="about-the-author">
<b class="author about-header">
About the Author
</b>
<table class="author box">
<tr>
<td>
<img alt="R. Tyler Croy" class="author logo" src="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/images/logos/transparent/transparent.svg">
</td>
<td>
<b class="author name">
R. Tyler Croy
</b>
<p>
<div class="paragraph">
<p>R&#46; Tyler Croy has been part of the Jenkins project for the past seven years.
While avoiding contributing any Java code, Tyler is involved in many of the
other aspects of the project which keep it running, such as this website,
infrastructure, governance, etc.</p>
</div>
</p>
<ul class="author social-media-buttons">
<li class="author">
<a href="https://github.com/rtyler" target="_blank">
GitHub
</a>
</li>
<li class="author">
<a href="https://twitter.com/agentdero" target="_blank">
Twitter
</a>
</li>
<li class="author">
<a href="http://unethicalblogger.com" target="_blank">
Blog
</a>
</li>
</ul>
</td>
</tr>
</table>
</div>

<!-- ending partial author.html.haml -->
</div>
</div>
</div>


<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/assets/bower/anchor-js/anchor.min.js"></script>
<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/assets/bower/tether/js/tether.min.js"></script>
<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/jenkins.io/edit/master/content//blog/2010/2010-07-08-a-python-love-story-virtualenv-and-hudson.html" title="Edit /blog/2010/2010-07-08-a-python-love-story-virtualenv-and-hudson.html on GitHub">
Improve this page
</a>
|
<a href="https://github.com/jenkins-infra/jenkins.io/commits/master/content//blog/2010/2010-07-08-a-python-love-story-virtualenv-and-hudson.html" title="View /blog/2010/2010-07-08-a-python-love-story-virtualenv-and-hudson.html history on GitHub">
Page history
</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
The content driving this site is licensed under the Creative
Commons Attribution-ShareAlike 4.0 license.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>Resources</h5>
<ul class="resources">
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/events">
Events
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/doc">
Documentation
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/node">
Blog
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Solutions</h5>
<ul>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/android">
Android
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/c">
C/C++
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/docker">
Docker
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/embedded">
Embedded
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/github">
GitHub
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/java">
Java
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/php">
PHP
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/pipeline">
Continuous Delivery
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/python">
Python
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/solutions/ruby">
Ruby
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Project</h5>
<ul class="project">
<li>
<a href="https://issues.jenkins-ci.org">
Issue tracker
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins on Jenkins
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Community</h5>
<ul class="community">
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-users">
Users mailing list
</a>
</li>
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">
Developers mailing list
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-461-update-imagesdir-references/merchandise">
Merchandise
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
</script>
</body>
</html>
