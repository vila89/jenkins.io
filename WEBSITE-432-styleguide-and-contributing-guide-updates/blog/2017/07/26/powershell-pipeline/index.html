<!DOCTYPE html>
<html>
<head>
<title>
Microsoft PowerShell Support for Pipeline
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins is an open source automation server" name="description">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/sites/default/files/jenkins_favicon.ico" rel="shortcut icon" type="image/x-icon">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/img/favicon.ico" rel="icon" sizes="32x32" type="img/png">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/img/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/img/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/img/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/img/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/img/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
<meta content="Microsoft PowerShell Support for Pipeline" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Microsoft PowerShell Support for Pipeline" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<!-- Open Graph data -->
<meta content="Microsoft PowerShell Support for Pipeline" property="og:title">
<meta content="article" property="og:type">
<meta content="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/blog/2017/07/26/powershell-pipeline/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="og:description">
<meta content="Microsoft PowerShell Support for Pipeline" property="og:site_name">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/css/font-icons.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/css/jenkins.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/css/footer.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/css/font-awesome.min.css" media="screen" rel="stylesheet">
</head>
<body>
<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/assets/bower/jquery/jquery.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<nav class="navbar navbar-toggleable-md navbar-inverse top bg-inverse fixed-top" id="ji-toolbar">
<div class="container">
<button class="navbar-toggler navbar-toggler-rght hidden-lg-up float-right" data-target="#CollapsingNavbar" data-toggle="collapse" type="button">
<i class="ion-navicon"></i>
</button>
<a class="navbar-brand" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates">
Jenkins
</a>
<div class="collapse navbar-collapse" id="CollapsingNavbar">
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/node">
Blog
</a>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
Documentation
</div>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/doc">
Use Jenkins
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/doc/developer">
Extend Jenkins
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
Use-cases
</div>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/android">
Android
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/c">
C/C++
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/docker">
Docker
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/embedded">
Embedded
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/github">
GitHub
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/java">
Java
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/php">
PHP
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/pipeline">
Continuous Delivery
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/python">
Python
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/ruby">
Ruby
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/participate">
Participate
</a>
</li>
<li class="dropdown nav-item">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">Sub-projects</div>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/projects/">
Overview
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/projects/blueocean/">
Blue Ocean
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/projects/gsoc/">
Google Summer of Code
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/projects/infrastructure/">
Infrastructure
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/projects/jam/">
Jenkins Area Meetups
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/projects/remoting/">
Jenkins Remoting
</a>
</div>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
Resources
</div>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://accounts.jenkins.io/" title="Create/manage your account for accessing wiki, issue tracker, etc">
Account Management
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/chat" title="Chat with the rest of the Jenkins community on IRC">
Chat
</a>
<a class="dropdown-item feature" href="https://issues.jenkins-ci.org/">
Issue Tracker
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/mailing-lists" title="Browse Jenkins mailing list archives and/or subscribe to lists">
Mailing Lists
</a>
<a class="dropdown-item feature" href="https://wiki.jenkins-ci.org/">
Wiki
</a>
</div>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
About
</div>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/security">
Security
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/press">
Press
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/awards">
Awards
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/project/conduct">
Conduct
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/artwork">
Artwork
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link btn btn-outline-secondary" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/download">
Download
</a>
</li>
</ul>
</div>
</div>
</nav>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('#content h' + i);
    }
  })
</script>
<div class="container blog-post">
<div class="row body">
<div class="col-md-11 col-md-offset-1 main-content" id="content">
<div id="content-top">
<h1>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/blog/2017/07/26/powershell-pipeline/" title="Microsoft PowerShell Support for Pipeline">
Microsoft PowerShell Support for Pipeline
</a>
</h1>
<div style="float: right; clear: all;">
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/share">
Tweet
</a>
</div>
<div class="post-attrs">
<span class="submitted">
Published on
2017-07-26
by
<a href="#about-the-author">Gabriel Loewen</a>
</span>
<ul class="list-inline tags">
<li>
<a class="tag-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/node/tags/durable-task">
durable-task
</a>
</li>
<li>
<a class="tag-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/node/tags/powershell">
powershell
</a>
</li>
</ul>
</div>
</div>
<div class="paragraph">
<p>I am pleased to announce Microsoft PowerShell support for Jenkins Pipeline!
As of <a href="https://plugins.jenkins.io/durable-task">Durable Task 1.14</a> and
<a href="https://plugins.jenkins.io/workflow-durable-task-step">Pipeline Nodes and Processes Plugin 2.12</a>, you will now be able to run Microsoft PowerShell scripts
directly in your Jenkins Pipeline projects.  This blog post covers the basics
of getting started with Microsoft PowerShell in Pipeline and provides some
basic examples.</p>
</div>
<div class="sect1">
<h2 id="introduction-to-microsoft-powershell"><a class="anchor" href="#introduction-to-microsoft-powershell"></a>Introduction to Microsoft PowerShell</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PowerShell is Microsoft&#8217;s open source and cross platform command line shell, as
well as an automation and configuration tool/framework which has a broad user
base. PowerShell can be used to perform common system administration tasks in
Windows, macOS, and Linux environments. It can also be used as a general
purpose scripting language. Now that Jenkins Pipeline supports PowerShell, you
can enjoy the rich set of features in PowerShell for your daily DevOps work.</p>
</div>
<div class="paragraph">
<p>Before diving into using PowerShell in your Pipeline, I recommend reading the
<a href="https://msdn.microsoft.com/en-us/library/ms714469(v=vs.85).aspx">Windows
PowerShell Reference</a> as well as the
<a href="https://blogs.msdn.microsoft.com/powershell/">PowerShell Team Blog</a> for an
introduction to PowerShell features, utilities, and as a quick look into the
PowerShell language.  Microsoft also has an active
<a href="https://github.com/powershell/powershell">PowerShell community</a> on GitHub,
which I highly recommend visiting to submit feature requests and bug
reports as you see fit. Jenkins Pipeline currently supports Microsoft
PowerShell 3.0 or higher, so also be sure to check which version of PowerShell
is installed on your system in order to take advantage of PowerShell in your
Pipeline.  Please note that we recommend that you upgrade to the latest stable
version of PowerShell available, which as of this writing is version 5.1.14393.</p>
</div>
<div class="sect2">
<h3 id="the-code-powershell-code-step"><a class="anchor" href="#the-code-powershell-code-step"></a>The <code>powershell</code> step</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    powershell <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Write-Output &quot;Hello, World!&quot;</span><span style="color:#710">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-microsoft-powershell-in-pipeline"><a class="anchor" href="#using-microsoft-powershell-in-pipeline"></a>Using Microsoft PowerShell in Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Writing PowerShell code as part of your pipeline is incredibly simple. The step that you will use is
simply <code>powershell</code>, and it includes the same optional parameters as the
Windows Batch (<code>bat</code>) step, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>returnStdout: Returns the standard output stream with a default encoding of UTF-8 (alternative encoding is optional)</p>
</li>
<li>
<p>returnStatus: Returns the exit status (integer) of the PowerShell script</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="examples"><a class="anchor" href="#examples"></a>Examples</h3>
<div class="sect3">
<h4 id="capture-exit-status-of-a-powershell-script"><a class="anchor" href="#capture-exit-status-of-a-powershell-script"></a>Capture exit status of a PowerShell script</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    <span style="color:#080;font-weight:bold">def</span> status = powershell(<span style="color:#606">returnStatus</span>: <span style="color:#069">true</span>, <span style="color:#606">script</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ipconfig</span><span style="color:#710">'</span></span>)
    <span style="color:#080;font-weight:bold">if</span> (status == <span style="color:#00D">0</span>) {
        <span style="color:#777">// Success!</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="capture-and-print-the-output-of-a-powershell-script"><a class="anchor" href="#capture-and-print-the-output-of-a-powershell-script"></a>Capture and print the output of a PowerShell script</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    <span style="color:#080;font-weight:bold">def</span> msg = powershell(<span style="color:#606">returnStdout</span>: <span style="color:#069">true</span>, <span style="color:#606">script</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Write-Output &quot;PowerShell is mighty!&quot;</span><span style="color:#710">'</span></span>)
    println msg
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="which-streams-get-returned-when-i-use-code-returnstdout-code"><a class="anchor" href="#which-streams-get-returned-when-i-use-code-returnstdout-code"></a>Which streams get returned when I use <code>returnStdout</code>?</h3>
<div class="paragraph">
<p>Until the release of PowerShell 5, there were five distinct output streams. PowerShell 5 introduced a sixth stream for pushing "informational" content,
with the added benefit of being able to capture messages sent to Write-Host. Each row of the following table describes a PowerShell stream along with
the corresponding Cmdlet used for writing to the stream for that particular row. Please keep in mind that stream 6 and associated cmdlets either
do not exist or exhibit alternate behavior in versions of PowerShell earlier than version 5.</p>
</div>
<table class="tableblock frame-topbot grid-all" style="width: 40%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Stream</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Cmdlet</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output stream (e.g. stdOut)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write-Output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error stream (e.g. stdErr)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write-Error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Warning stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write-Warning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verbose stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write-Verbose</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write-Debug</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Information stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write-Information (or Write-Host with <a href="https://blogs.technet.microsoft.com/heyscriptingguy/2015/07/04/weekend-scripter-welcome-to-the-powershell-information-stream/">caveats</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you are using the <code>returnStdout</code> option of the <code>powershell</code> Pipeline step
then <strong>only</strong> stream 1 will be returned, while streams 2-6 will be redirected to
the console output. For example:</p>
</div>
<div class="sect3">
<h4 id="write-to-all-available-streams-and-return-the-standard-output"><a class="anchor" href="#write-to-all-available-streams-and-return-the-standard-output"></a>Write to all available streams and return the standard output</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    <span style="color:#080;font-weight:bold">def</span> stdout = powershell(<span style="color:#606">returnStdout</span>: <span style="color:#069">true</span>, <span style="color:#606">script</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
        # Enable streams 3-6
        $WarningPreference = 'Continue'
        $VerbosePreference = 'Continue'
        $DebugPreference = 'Continue'
        $InformationPreference = 'Continue'

        Write-Output 'Hello, World!'
        Write-Error 'Something terrible has happened!'
        Write-Warning 'Warning! There is nothing wrong with your television set'
        Write-Verbose 'Do not attempt to adjust the picture'
        Write-Debug 'We will control the horizontal.  We will control the vertical'
        Write-Information 'We can change the focus to a soft blur or sharpen it to crystal clarity.'
    </span><span style="color:#710">'''</span></span>)
    println stdout
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="console-output"><a class="anchor" href="#console-output"></a>Console output:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>[Pipeline] {
[Pipeline] powershell
[TestStreams] Running PowerShell script
﻿&lt;Jenkins Home&gt;\workspace\TestStreams@tmp\durable-4d924c2d\powershellScript.ps1 : Something terrible has
happened!
At ﻿&lt;Jenkins Home&gt;\workspace\TestStreams@tmp\durable-4d924c2d\powershellMain.ps1:2 char:1
+ &amp; '﻿&lt;Jenkins Home&gt;\workspace\TestStreams@tmp\durable-4d924c ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:) [Write-Error], WriteErrorException
    + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorException,powershellScript.ps1

Warning! There is nothing wrong with your television set
Do not attempt to adjust the picture
We will control the horizontal.  We will control the vertical
We can change the focus to a soft blur or sharpen it to crystal clarity.
Hello, World!
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
ERROR: script returned exit code 1
Finished: FAILURE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that "Hello, World!" gets printed last even though it is the first output
statement in my script.  Another interesting aspect of this example is that the
<code>powershell</code> step failed, which ultimately caused the job to fail. The failure
in this example is due to the PowerShell error stream being non-empty, which
therefore caused the step to result in a non-zero exit status. However, as you
will soon discover, there are a variety of causes for a failing <code>powershell</code>
step.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="what-causes-a-failing-exit-status"><a class="anchor" href="#what-causes-a-failing-exit-status"></a>What causes a failing exit status?</h3>
<div class="paragraph">
<p>When you execute a <code>powershell</code> step, it may produce a non-zero exit code and
fail your pipeline build.  This is very similar to other shell steps with some
interesting caveats. Your <code>powershell</code> step may produce a failing exit status
in the following instances:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Something in your PowerShell script has thrown an exception</p>
</li>
<li>
<p>Your PowerShell script explicitly calls <code>exit</code> with a non-zero exit code</p>
</li>
<li>
<p>Your PowerShell script calls a native application that produces a non-zero <code>$LastExitCode</code></p>
<div class="ulist">
<ul>
<li>
<p>$LastExitCode is an <a href="https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.core/about/about_automatic_variables">automatic variable</a> that is set after executing a native application</p>
</li>
</ul>
</div>
</li>
<li>
<p>Your PowerShell script results in a non-empty error stream (with or without throwing an exception)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Overriding the exit status behavior of your <code>powershell</code> step can be achieved
by explicitly exiting from your script as long as the failure was not caused by
an unhandled exception. For example:</p>
</div>
<div class="sect3">
<h4 id="unavoidable-failure-caused-by-an-unhandled-exception"><a class="anchor" href="#unavoidable-failure-caused-by-an-unhandled-exception"></a>Unavoidable failure caused by an unhandled exception</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    powershell <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
        throw 'Error! Problem Exists Between Keyboard And Chair'
        exit 0  # Unreachable code
    </span><span style="color:#710">'''</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="failed-step-caused-by-a-non-empty-error-stream"><a class="anchor" href="#failed-step-caused-by-a-non-empty-error-stream"></a>Failed step caused by a non-empty error stream</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    powershell <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
        Write-Error 'Error! Problem Exists Between Keyboard And Chair'
    </span><span style="color:#710">'''</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="failure-prevented-by-an-explicit-exit"><a class="anchor" href="#failure-prevented-by-an-explicit-exit"></a>Failure prevented by an explicit exit</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">node {
    powershell <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'''</span><span style="color:#D20">
        Write-Error 'Error! Problem Exists Between Keyboard And Chair'
        exit 0
    </span><span style="color:#710">'''</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scripts-vs-cmdlets"><a class="anchor" href="#scripts-vs-cmdlets"></a>Scripts vs. Cmdlets</h3>
<div class="paragraph">
<p>A Cmdlet is a small lightweight utility written in either C#, and compiled, or
written in PowerShell directly. Depending on what your goal is in your pipeline
you can make use of Cmdlets directly in your pipeline code, call a self
contained PowerShell script, or some mixture of the two. If your strategy is to
keep each <code>powershell</code> step as short and succinct as possible then it may make
sense for you to write a library of Cmdlets, but if you have monolithic scripts
then it may make sense for you to call those scripts directly from your
pipeline. The choice is entirely up to you, as both scenarios are supported.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="thanks-for-reading-and-have-fun"><a class="anchor" href="#thanks-for-reading-and-have-fun"></a>Thanks for reading, and have fun!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I sincerely hope that this post has encouraged you to try using PowerShell in
your Jenkins Pipeline. Please do not hesitate to file an issue against the
<a href="https://wiki.jenkins.io/display/JENKINS/Durable+Task+Plugin">durable-task</a>
plugin on
<a href="http://issues.jenkins-ci.org/secure/IssueNavigator.jspa?mode=hide&amp;reset=true&amp;jqlQuery=project+%3D+JENKINS+AND+status+in+%28Open%2C+%22In+Progress%22%2C+Reopened%29+AND+component+%3D+%27durable-task-plugin%27">JIRA</a>
if you have discovered any problem that you suspect is related to the
<code>powershell</code> step.  For general PowerShell related issues or inquiries
please route your questions to the
<a href="https://github.com/powershell/powershell">PowerShell community</a>.</p>
</div>
</div>
</div>
<!-- starting partial author.html.haml -->
<div id="about-the-author">
<b class="author about-header">
About the Author
</b>
<table class="author box">
<tr>
<td>
<img alt="Gabriel Loewen" class="author logo" src="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/images/logos/transparent/transparent.svg">
</td>
<td>
<b class="author name">
Gabriel Loewen
</b>
<p>
This author has no biography defined.
See social media links referenced below.
</p>
<ul class="author social-media-buttons">
<li class="author">
<a href="https://github.com/gabloe" target="_blank">
GitHub
</a>
</li>
</ul>
</td>
</tr>
</table>
</div>

<!-- ending partial author.html.haml -->
</div>
</div>
</div>


<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/assets/bower/anchor-js/anchor.min.js"></script>
<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/assets/bower/tether/js/tether.min.js"></script>
<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/jenkins.io/edit/master/content//blog/2017/07/2017-07-26-powershell-pipeline.adoc" title="Edit /blog/2017/07/2017-07-26-powershell-pipeline.adoc on GitHub">
Improve this page
</a>
|
<a href="https://github.com/jenkins-infra/jenkins.io/commits/master/content//blog/2017/07/2017-07-26-powershell-pipeline.adoc" title="View /blog/2017/07/2017-07-26-powershell-pipeline.adoc history on GitHub">
Page history
</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
The content driving this site is licensed under the Creative
Commons Attribution-ShareAlike 4.0 license.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>Resources</h5>
<ul class="resources">
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/events">
Events
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/doc">
Documentation
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/node">
Blog
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Solutions</h5>
<ul>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/android">
Android
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/c">
C/C++
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/docker">
Docker
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/embedded">
Embedded
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/github">
GitHub
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/java">
Java
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/php">
PHP
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/pipeline">
Continuous Delivery
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/python">
Python
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/solutions/ruby">
Ruby
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Project</h5>
<ul class="project">
<li>
<a href="https://issues.jenkins-ci.org">
Issue tracker
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins on Jenkins
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Community</h5>
<ul class="community">
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-users">
Users mailing list
</a>
</li>
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">
Developers mailing list
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/merchandise">
Merchandise
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-432-styleguide-and-contributing-guide-updates/awards">
Awards
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
</script>
</body>
</html>
