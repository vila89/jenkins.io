<!DOCTYPE html>
<html>
<head>
<title>
Continuous Integration for C/C++ Projects with Jenkins and Conan
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins is an open source automation server" name="description">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/sites/default/files/jenkins_favicon.ico" rel="shortcut icon" type="image/x-icon">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/img/favicon.ico" rel="icon" sizes="32x32" type="img/png">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/img/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/img/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/img/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/img/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/img/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
<meta content="Continuous Integration for C/C++ Projects with Jenkins and Conan" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Continuous Integration for C/C++ Projects with Jenkins and Conan" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<!-- Open Graph data -->
<meta content="Continuous Integration for C/C++ Projects with Jenkins and Conan" property="og:title">
<meta content="article" property="og:type">
<meta content="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/blog/2017/07/07/jenkins-conan/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="og:description">
<meta content="Continuous Integration for C/C++ Projects with Jenkins and Conan" property="og:site_name">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/css/font-icons.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/css/jenkins.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/css/footer.css" media="screen" rel="stylesheet">
<link href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/css/font-awesome.min.css" media="screen" rel="stylesheet">
</head>
<body>
<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/assets/bower/jquery/jquery.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<nav class="navbar navbar-toggleable-md navbar-inverse top bg-inverse fixed-top" id="ji-toolbar">
<div class="container">
<button class="navbar-toggler navbar-toggler-rght hidden-lg-up float-right" data-target="#CollapsingNavbar" data-toggle="collapse" type="button">
<i class="ion-navicon"></i>
</button>
<a class="navbar-brand" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages">
Jenkins
</a>
<div class="collapse navbar-collapse" id="CollapsingNavbar">
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/node">
Blog
</a>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
Documentation
</div>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/doc">
Use Jenkins
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/doc/developer">
Extend Jenkins
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://plugins.jenkins.io/">
Plugins
</a>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
Use-cases
</div>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/android">
Android
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/c">
C/C++
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/docker">
Docker
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/embedded">
Embedded
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/github">
GitHub
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/java">
Java
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/php">
PHP
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/pipeline">
Continuous Delivery
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/python">
Python
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/ruby">
Ruby
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/participate">
Participate
</a>
</li>
<li class="dropdown nav-item">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">Sub-projects</div>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/projects/">
Overview
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/projects/blueocean/">
Blue Ocean
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/projects/gsoc/">
Google Summer of Code
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/projects/infrastructure/">
Infrastructure
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/projects/jam/">
Jenkins Area Meetups
</a>
<a class="dropdown-item feature" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/projects/remoting/">
Jenkins Remoting
</a>
</div>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
Resources
</div>
<div class="dropdown-menu">
<a class="dropdown-item feature" href="https://accounts.jenkins.io/" title="Create/manage your account for accessing wiki, issue tracker, etc">
Account Management
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/chat" title="Chat with the rest of the Jenkins community on IRC">
Chat
</a>
<a class="dropdown-item feature" href="https://issues.jenkins-ci.org/">
Issue Tracker
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/mailing-lists" title="Browse Jenkins mailing list archives and/or subscribe to lists">
Mailing Lists
</a>
<a class="dropdown-item feature" href="https://wiki.jenkins-ci.org/">
Wiki
</a>
</div>
</li>
<li class="nav-item dropdown">
<div aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button">
About
</div>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/security">
Security
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/press">
Press
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/project/conduct">
Conduct
</a>
<a class="dropdown-item" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/artwork">
Artwork
</a>
</div>
</li>
<li class="nav-item">
<a class="nav-link btn btn-outline-secondary" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/download">
Download
</a>
</li>
</ul>
</div>
</div>
</nav>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('#content h' + i);
    }
  })
</script>
<div class="container blog-post">
<div class="row body">
<div class="col-md-11 col-md-offset-1 main-content" id="content">
<div id="content-top">
<h1>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/blog/2017/07/07/jenkins-conan/" title="Continuous Integration for C/C++ Projects with Jenkins and Conan">
Continuous Integration for C/C++ Projects with Jenkins and Conan
</a>
</h1>
<div style="float: right; clear: all;">
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/share">
Tweet
</a>
</div>
<div class="post-attrs">
<span class="submitted">
Published on
2017-07-07
by
<a href="#about-the-author">Alyssa Tong</a>
</span>
<ul class="list-inline tags">
<li>
<a class="tag-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/node/tags/event">
event
</a>
</li>
<li>
<a class="tag-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/node/tags/jenkins-user-conference">
jenkins-user-conference
</a>
</li>
<li>
<a class="tag-link" href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/node/tags/jenkins-community-day-paris">
jenkins-community-day-paris
</a>
</li>
</ul>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is a guest post by Luis Martínez de Bartolomé,
<a href="http://conan.io">Conan</a> Co-Founder
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>C and C&#43;&#43; are present in very important industries today, including Operating Systems, embedded systems, finances, research, automotive, robotics, gaming, and many more. The main reason for this is performance, which is critical to many of these industries, and cannot be compared to any other technology.
As a counterpart, the C/C&#43;&#43; ecosystem has a few important challenges to face:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Huge projects</strong> - With millions of lines of code, it’s very hard to manage your projects without using modern tools.</p>
</li>
<li>
<p><strong>Application Binary Interface (ABI) incompatibility</strong> - To guarantee the compatibility of a library with other libraries and your application,  different configurations (such as the operating system, architecture, and compiler) need to be under control.</p>
</li>
<li>
<p><strong>Slow compilation times</strong> - Due to header inclusion and pre-processor bloat, together with the challenges mentioned above, it requires special attention to optimize the process and rebuild only the libraries that need to be rebuilt.</p>
</li>
<li>
<p><strong>Code linkage and inlining</strong> - A static C/C&#43;&#43; library can embed headers from a dependent library. Also, a shared library can embed a static library. In both cases, you need to manage the rebuild of your library when any of its dependencies change.</p>
</li>
<li>
<p><strong>Varied ecosystem</strong> - There are many different compilers and build systems, for different platforms, targets and purposes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This post will show how to implement DevOps best practices for C/C&#43;&#43; development, using <strong>Jenkins</strong> CI, <strong>Conan</strong> C/C&#43;&#43; package manager, and <strong>JFrog Artifactory</strong> the universal artifact repository.</p>
</div>
<div class="sect1">
<h2 id="conan-the-c-c-package-manager"><a class="anchor" href="#conan-the-c-c-package-manager"></a>Conan, The C/C&#43;&#43; Package Manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://conan.io">Conan</a> was born to mitigate these pains.</p>
</div>
<div class="paragraph">
<p>Conan uses python recipes, describing how to build a library by explicitly calling any build system, and also describing the needed information for the consumers (include directories, library names etc.).
To manage the different configurations and the ABI compatibility, Conan uses "settings" (os, architecture, compiler…). When a setting is changed, Conan generates a different binary version for the same library:</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2017-07-07/diagram1.png" alt="diagram1"></span></p>
</div>
<div class="paragraph">
<p>The built binaries can be uploaded to <a href="https://www.jfrog.com/artifactory/">JFrog Artifactory</a> or <a href="https://www.jfrog.com/bintray/">Bintray</a>, to be shared with your team or the whole community. The developers in your team won’t need to rebuild the libraries again, Conan will fetch only the needed Binary packages matching the user’s configuration from the configured remotes (distributed model).
But there are still some more challenges to solve:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to manage the development and release process of your C/C&#43;&#43; projects?</p>
</li>
<li>
<p>How to distribute your C/C&#43;&#43; libraries?</p>
</li>
<li>
<p>How to test your C/C&#43;&#43; project?</p>
</li>
<li>
<p>How to generate multiple packages for different configurations?
*How to manage the rebuild of the libraries when one of them changes?</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conan-ecosystem"><a class="anchor" href="#conan-ecosystem"></a>Conan Ecosystem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Conan ecosystem is growing fast, and DevOps with C/C&#43;&#43; is now a reality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>JFrog Artifactory</strong> manages the full development and releasing cycles.</p>
</li>
<li>
<p><strong>JFrog Bintray</strong> is the universal distribution hub.</p>
</li>
<li>
<p><strong>Jenkins</strong> automates the project testing, generates different binary configurations of your Conan packages, and automates the rebuilt libraries.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2017-07-07/diagram2.png" alt="diagram2"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jenkins-artifactory-plugin"><a class="anchor" href="#jenkins-artifactory-plugin"></a>Jenkins Artifactory plugin</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Provides a Conan DSL, a very generic but powerful way to call Conan from a Jenkins Pipeline script.</p>
</li>
<li>
<p>Manages the remote configuration with your Artifactory instance, hiding the authentication details.</p>
</li>
<li>
<p>Collects from any Conan operation (installing/uploading packages) all the involved artifacts to generate and publish the buildInfo to Artifactory. The <a href="https://www.jfrog.com/confluence/display/RTF/Build+Integration#BuildIntegration-Build-levelInformation">buildInfo</a> object is very useful, for example, to promote the created Conan packages to a different repository and to have full traceability of the Jenkins build:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2017-07-07/JFrogArtifactoryBuildBrowser.png" alt="JFrogArtifactoryBuildBrowser"></span></p>
</div>
<div class="paragraph">
<p>Here’s an example of the Conan DSL with the Artifactory plugin.  First we configure the Artifactory repository, then retrieve the dependencies and finally build it:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">def artifactory_name = "artifactory"
def artifactory_repo = "conan-local"
def repo_url = 'https://github.com/memsharded/example-boost-poco.git'
def repo_branch = 'master'</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">node {
   def server
   def client
   def serverName</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">stage("Get project"){
    git branch: repo_branch, url: repo_url
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">stage("Configure Artifactory/Conan"){
    server = Artifactory.server artifactory_name
    client = Artifactory.newConanClient()
    serverName = client.remote.add server: server, repo: artifactory_repo
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">stage("Get dependencies and publish build info"){
    sh "mkdir -p build"
    dir ('build') {
      def b = client.run(command: "install ..")
      server.publishBuildInfo b
    }
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">    stage("Build/Test project"){
        dir ('build') {
          sh "cmake ../ &amp;&amp; cmake --build ."
        }
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>You can see in the above example that the Conan DSL is very explicit. It helps a lot with common operations, but also allows powerful and custom integrations. This is very important for C/C&#43;&#43; projects, because every company has a very specific project structure, custom integrations etc.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="complex-jenkins-pipeline-operations-managed-and-parallelized-libraries-building"><a class="anchor" href="#complex-jenkins-pipeline-operations-managed-and-parallelized-libraries-building"></a>Complex Jenkins Pipeline operations: Managed and parallelized libraries building</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we saw at the beginning of this blog post, it’s crucial to save time when building a C/C&#43;&#43; project. Here are several ways to optimize the process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only re-build the libraries that need to be rebuilt. These are the libraries that  have been affected by a dependant library that has changed.</p>
</li>
<li>
<p>Build in parallel, if possible. When there is no relation between two or more libraries in the project graph, you can build them in parallel.</p>
</li>
<li>
<p>Build different configurations (os, compiler, etc) in parallel. Use different slaves if needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s see an example using Jenkins Pipeline feature</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2017-07-07/diagram3.png" alt="diagram3"></span></p>
</div>
<div class="paragraph">
<p>The above graph represents our project P and its dependencies (A-G). We want to distribute the project for two different architectures, x86 and x86_64.</p>
</div>
<div class="paragraph">
<p><strong>What happens if we change library A?</strong></p>
</div>
<div class="paragraph">
<p>If we bump the version to A(v1) there is no problem, we can update the B requirement and also bump its version to B(v1) and so on. The complete flow would be as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Push A(v1) version to Git, Jenkins will build the x86 and x86_64 binaries. Jenkins will upload all the packages to Artifactory.</p>
</li>
<li>
<p>Manually change B to v1, now depending on A1, push to Git, Jenkins will build the B(v1) for x86 and x86_64 using the retrieved new A1 from Artifactory.</p>
</li>
<li>
<p>Repeat the same process for C, D, F, G and finally our project.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But if we are developing our libraries in a development repository, we probably depend on the latest A version or will override A (v0) packages on every git push, and we want to automatically rebuild the affected libraries in this case B, D, F, G and P.</p>
</div>
<div class="paragraph">
<p><strong>How we can do this with Jenkins Pipelines?</strong></p>
</div>
<div class="paragraph">
<p>First we need to know which libraries need to be rebuilt. The "conan info --build_order" command identifies the libraries that were changed in our project, and also tells us which can be rebuilt in parallel.</p>
</div>
<div class="paragraph">
<p>So, we created two Jenkins pipelines tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://github.com/lasote/skynet_example/blob/master/single_build.groovy">SimpleBuild</a> task which builds every single library. Similar to the first example using Conan DSL with the Jenkins Artifactory plugin. It’s a parameterized task that receives the libraries that need to built.</p>
</li>
<li>
<p>The <a href="https://github.com/lasote/skynet_example/blob/master/multi_build.groovy">MultiBuild</a> task which coordinates and launches the "<strong>SimpleBuild</strong>" tasks, in parallel when possible.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We also have a repository with a configuration yml. The Jenkins tasks will use it to know where the recipe of each library is, and the different profiles to be used. In this case they are <strong>x86</strong> and <strong>x86_64</strong>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">leaves:
  PROJECT:
    profiles:
       - ./profiles/osx_64
       - ./profiles/osx_32</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">artifactory:
  name: artifactory
  repo: conan-local</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">repos:
 LIB_A/1.0:
   url: https://github.com/lasote/skynet_example.git
   branch: master
   dir: ./recipes/A</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">LIB_B/1.0:
 url: https://github.com/lasote/skynet_example.git
 branch: master
 dir: ./recipes/b</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">…</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">PROJECT:
 url: https://github.com/lasote/skynet_example.git
 branch: master
 dir: ./recipes/PROJECT</pre>
</div>
</div>
<div class="paragraph">
<p>If we change and push library A to the repository, the "<strong>MultiBuild</strong>" task will be triggered. It will start by checking which libraries need to be rebuilt, using the "conan info" command.
Conan will return something like this:
<strong>[B, [D, F], G]</strong></p>
</div>
<div class="paragraph">
<p>This means that we need to start building B, then we can build D and F in parallel, and finally build G. Note that library C does not need to be rebuilt, because it’s not affected by a change in library A.</p>
</div>
<div class="paragraph">
<p>The "<strong>MultiBuild</strong>" Jenkins pipeline script will create closures with the parallelized calls to the "<strong>SimpleBuild</strong>" task, and finally launch the groups in parallel.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">//for each group
      tasks = [:]
      // for each dep in group
         tasks[label] = { -&gt; build(job: "SimpleBuild",
                            parameters: [
                               string(name: "build_label", value: label),
                               string(name: "channel", value: a_build["channel"]),
                               string(name: "name_version", value: a_build["name_version"]),
                               string(name: "conf_repo_url", value: conf_repo_url),
                               string(name: "conf_repo_branch", value: conf_repo_branch),
                               string(name: "profile", value: a_build["profile"])
                            ]
                     )
          }
     parallel(tasks)</pre>
</div>
</div>
<div class="paragraph">
<p>Eventually, this is what will happen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Two <strong>SimpleBuild</strong> tasks will be  triggered, both for building library B, one for x86 and another for x86_64 architectures</p>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2017-07-07/diagram4.png" alt="diagram4"></span></p>
</div>
</li>
<li>
<p>Once "A" and "B" are built, "F" and "D" will be triggered, 4 workers will run the "SimpleBuild" task in parallel, (x86, x86_64)</p>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2017-07-07/diagram5.png" alt="diagram5"></span></p>
</div>
</li>
<li>
<p>Finally "G" will be built. So 2 workers will run in parallel.</p>
<div class="paragraph">
<p>The Jenkins Stage View for the will looks similar to the figures below:</p>
</div>
<div class="paragraph">
<div class="title">MultiBuild</div>
<p><span class="image center"><img src="/images/post-images/2017-07-07/MultiBuild.png" alt="MultiBuild"></span></p>
</div>
<div class="paragraph">
<div class="title">SimpleBuild</div>
<p><span class="image center"><img src="/images/post-images/2017-07-07/SimpleBuild.png" alt="SimpleBuild"></span></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can configure the "<strong>SimpleBuild</strong>" task within different nodes (Windows, OSX, Linux…), and control the number of executors available in our Jenkins configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusions"><a class="anchor" href="#conclusions"></a>Conclusions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Embracing DevOps for C/C&#43;&#43; is still marked as a to-do for many companies. It requires a big investment of time but can save huge amounts of time in the development and releasing life cycle for the long run. Moreover it increases the quality and the reliability of the C/C&#43;&#43; products. Very soon, adoption of DevOps for C/C&#43;&#43; companies will be a must!</p>
</div>
<div class="paragraph">
<p>The Jenkins example shown above that demonstrating how to control the library building in parallel is just Groovy code and a custom convenient yml file. The great thing about it is not the example or the code itself. The great thing is the possibility of defining your own pipeline scripts to adapt to your specific workflows, thanks to Jenkins Pipeline, Conan and JFrog Artifactory.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>More on this topic will be presented at <a href="https://jcd-paris.jfrog.com">Jenkins Community Day Paris</a> on
July 11, and <a href="https://www.eventbrite.com/e/jenkins-user-conference-2017-israel-tlv-intercontinental-david-tickets-32226522396">Jenkins User Conference Israel</a> on July 13.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<!-- starting partial author.html.haml -->
<div id="about-the-author">
<b class="author about-header">
About the Author
</b>
<table class="author box">
<tr>
<td>
<img alt="Alyssa Tong" class="author logo" src="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/images/logos/transparent/transparent.svg">
</td>
<td>
<b class="author name">
Alyssa Tong
</b>
<p>
<div class="paragraph">
<p>Jenkins Event Officer.
Alyssa runs
the <a href="/projects/jam">Jenkins Area Meetup</a> program and is also responsible for
Marketing &amp; Community Programs at <a href="http://cloudbees.com">CloudBees, Inc.</a></p>
</div>
</p>
<ul class="author social-media-buttons">
<li class="author">
<a href="https://github.com/alyssat" target="_blank">
GitHub
</a>
</li>
</ul>
</td>
</tr>
</table>
</div>

<!-- ending partial author.html.haml -->
</div>
</div>
</div>


<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/assets/bower/anchor-js/anchor.min.js"></script>
<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/assets/bower/tether/js/tether.min.js"></script>
<script src="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/jenkins.io/edit/master/content//blog/2017/07/2017-07-07-jenkins-conan.adoc" title="Edit /blog/2017/07/2017-07-07-jenkins-conan.adoc on GitHub">
Improve this page
</a>
|
<a href="https://github.com/jenkins-infra/jenkins.io/commits/master/content//blog/2017/07/2017-07-07-jenkins-conan.adoc" title="View /blog/2017/07/2017-07-07-jenkins-conan.adoc history on GitHub">
Page history
</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
The content driving this site is licensed under the Creative
Commons Attribution-ShareAlike 4.0 license.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>Resources</h5>
<ul class="resources">
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/events">
Events
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/doc">
Documentation
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/node">
Blog
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Solutions</h5>
<ul>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/android">
Android
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/c">
C/C++
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/docker">
Docker
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/embedded">
Embedded
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/github">
GitHub
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/java">
Java
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/php">
PHP
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/pipeline">
Continuous Delivery
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/python">
Python
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/solutions/ruby">
Ruby
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Project</h5>
<ul class="project">
<li>
<a href="https://issues.jenkins-ci.org">
Issue tracker
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins on Jenkins
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>Community</h5>
<ul class="community">
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-users">
Users mailing list
</a>
</li>
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">
Developers mailing list
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
<li>
<a href="https://gilesgas.github.io/jenkins.io/WEBSITE-453-update-main-blue-ocean-and-getting-started-pages/merchandise">
Merchandise
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
</script>
</body>
</html>
